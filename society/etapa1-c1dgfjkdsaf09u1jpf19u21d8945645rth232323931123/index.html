<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Iron Society</title>

  <style>
    :root { color-scheme: dark; }
    html, body {
      height: 100%;
      margin: 0;
      background: #000;
      font-family: "Times New Roman", Times, serif;
      overflow: hidden;
        -webkit-user-select: none; user-select: none;
  -webkit-touch-callout: none;
  touch-action: none;
      -webkit-text-size-adjust: 100%;
    }



    .phrase.special{
  font-size: clamp(30px, 5vw, 52px);
  line-height: 1.2;
}

    .wrap{
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 24px;
      box-sizing:border-box;
    }

    .stack{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 14px;
      max-width: 840px;
      width: 100%;
    }

    /* Relógio maior */
    .timer{
      font-size: 54px;
      letter-spacing: 0.10em;
      opacity: 0.95;
      user-select: none;
      font-variant-numeric: tabular-nums;
    }

    /* Frase um pouco menor */
    .phrase{
      font-size: clamp(18px, 3.2vw, 30px);
      line-height: 1.25;
      font-style: italic;
      color: #f2f2f2;
      opacity: 0;
      transition: opacity 1400ms ease;
      user-select: none;
      text-wrap: balance;
      padding: 0 4px;
    }
    .phrase.show{ opacity: 1; }

    /* Botão aço/ferro */
   .advance{
  opacity: 0;
  pointer-events: none;
  margin-top: 12px;
  padding: 8px 14px;
  border-radius: 2px;
  border: 1px solid rgba(255,255,255,0.22);
  background:
    linear-gradient(145deg,
      rgba(190,190,190,0.22),
      rgba(90,90,90,0.22)
    );
  color: rgba(255,255,255,0.9);
  font-family: "Times New Roman", Times, serif;
  font-size: 14px;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  text-decoration: none;
  cursor: pointer;
  user-select: none;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,0.15),
    inset 0 -1px 0 rgba(0,0,0,0.35),
    0 6px 14px rgba(0,0,0,0.6);

  transition: opacity 1200ms ease; /* fade */
}

.advance.show{
  opacity: 1;
  pointer-events: auto;
}
.advance:hover{
  background:
    linear-gradient(145deg,
      rgba(210,210,210,0.26),
      rgba(110,110,110,0.26)
    );
}

.advance:active{
  transform: translateY(1px);
}
  </style>
</head>

<body>
  <main class="wrap" aria-label="Iron Society">
    <section class="stack">
      <div id="timer" class="timer">--:--:--</div>
      <div id="phrase" class="phrase"></div>
      <a id="advance" class="advance" href="/society/etapa2-c1dgfjkdsaf09123f1x19u21d8945645rth223cc55map12vaa/" rel="noopener">Avançar</a>
    </section>
  </main>

  <script>
  const WINDOW_START_HOUR = 3;
  const WINDOW_START_MIN  = 0;
  const WINDOW_END_HOUR   = 6;
  const WINDOW_END_MIN    = 0;

  const ADVANCE_URL = "/society/etapa2-c1dgfjkdsaf09123f1x19u21d8945645rth223cc55map12vaa/";
  const TIME_API_URL = "https://worldtimeapi.org/api/timezone/America/Sao_Paulo";

  const phrases = [
    "A pressa é inimiga da perfeição.",
    "Quem espera, sempre alcança.",
    "A direção é mais importante que a velocidade.",
    "Constância vence intensidade desorganizada.",
    "Disciplina diária constrói o que motivação não sustenta.",
    "Resultados duradouros são fruto de decisões repetidas, não de impulsos.",
    "“Tudo tem o seu tempo determinado.” (Eclesiastes 3:1)",
    "“Melhor é o fim das coisas do que o seu começo.” (Eclesiastes 7:8)",
    "“Aquele que é fiel no pouco, também é fiel no muito.” (Lucas 16:10)",
    "“Os planos bem elaborados levam à fartura.” (Provérbios 21:5)"
  ];

  const specialPhrase = "Quem espera no Senhor, celebra a vitória.";

  const $timer = document.getElementById("timer");
  const $phrase = document.getElementById("phrase");
  const $advance = document.getElementById("advance");
  $advance.href = ADVANCE_URL;

  const pad2 = n => String(n).padStart(2, "0");

  let serverEpochMs = null;
  let basePerfMs = null;

  // Controle da rotação
  let rotationId = null;
  let lastIndex = -1;

  // Estado atual: dentro/fora da janela
  let wasInWindow = null;

  function nowFromServerMs(){
    if (serverEpochMs == null || basePerfMs == null) return null;
    const elapsed = performance.now() - basePerfMs;
    return serverEpochMs + elapsed;
  }

  async function syncTime(){
    try{
      const res = await fetch(TIME_API_URL, { cache: "no-store" });
      if(!res.ok) throw new Error("Falha ao buscar hora");
      const data = await res.json();
      serverEpochMs = data.unixtime * 1000;
      basePerfMs = performance.now();
    } catch(e){
      serverEpochMs = null;
      basePerfMs = null;
      $timer.textContent = "--:--:--";
      $advance.style.display = "none";
    }
  }

  setInterval(syncTime, 60_000);

  function startOfWindowMs(epochMs){
    const d = new Date(epochMs);
    d.setHours(WINDOW_START_HOUR, WINDOW_START_MIN, 0, 0);
    return d.getTime();
  }
  function endOfWindowMs(epochMs){
    const d = new Date(epochMs);
    d.setHours(WINDOW_END_HOUR, WINDOW_END_MIN, 0, 0);
    return d.getTime();
  }
  function inWindow(epochMs){
    const start = startOfWindowMs(epochMs);
    const end = endOfWindowMs(epochMs);
    return epochMs >= start && epochMs < end;
  }
  function nextWindowStartMs(epochMs){
    const startToday = startOfWindowMs(epochMs);
    if (epochMs < startToday) return startToday;
    const d = new Date(startToday);
    d.setDate(d.getDate() + 1);
    return d.getTime();
  }

  function formatHMS(ms){
    const total = Math.max(0, Math.floor(ms / 1000));
    const h = Math.floor(total / 3600);
    const m = Math.floor((total % 3600) / 60);
    const s = total % 60;
    return `${pad2(h)}:${pad2(m)}:${pad2(s)}`;
  }

  function setPhrase(text){
    $phrase.classList.remove("show");
    setTimeout(() => {
      $phrase.textContent = text;
      $phrase.classList.add("show");
    }, 700);
  }

  function pickRandomPhrase(){
    let idx = Math.floor(Math.random() * phrases.length);
    if (idx === lastIndex) idx = (idx + 1) % phrases.length;
    lastIndex = idx;
    return phrases[idx];
  }

  function startRotation(){
    stopRotation();
    setPhrase(pickRandomPhrase());
    rotationId = setInterval(() => {
      const t = nowFromServerMs();
      if (t == null) return;
      if (inWindow(t)) return;
      setPhrase(pickRandomPhrase());
    }, 7000);
  }

    // ✅ Trocar frase ao tocar/clicar na tela (fora da janela)
  function onUserTapChangePhrase(e){
    const t = nowFromServerMs();
    if (t == null) return;

    // Se estiver dentro da janela (03:00–06:00), não troca a frase especial
    if (inWindow(t)) return;

    // Evita trocar ao clicar no botão "Avançar"
    if (e && (e.target?.closest?.("#advance"))) return;

    setPhrase(pickRandomPhrase());
  }

  // pointerdown funciona bem em mobile e desktop
  document.addEventListener("pointerdown", onUserTapChangePhrase, { passive: true });

  // fallback extra (caso algum browser não dispare pointer)
  document.addEventListener("touchstart", onUserTapChangePhrase, { passive: true });
  document.addEventListener("mousedown", onUserTapChangePhrase, { passive: true });
  
  function stopRotation(){
    if (rotationId) {
      clearInterval(rotationId);
      rotationId = null;
    }
  }

 let advanceTimeout = null;

function enterWindowMode(){
  stopRotation();

  // Frase especial maior
  $phrase.classList.add("special");
  setPhrase(specialPhrase);

  // Esconde relógio
  $timer.style.display = "none";

  // Garante botão invisível inicialmente
  $advance.classList.remove("show");
  if (advanceTimeout) clearTimeout(advanceTimeout);

  // Fade-in após 2 segundos
  advanceTimeout = setTimeout(() => {
    $advance.classList.add("show");
  }, 2000);
}

function exitWindowMode(){
  if (advanceTimeout) {
    clearTimeout(advanceTimeout);
    advanceTimeout = null;
  }

  // Remove estilo especial
  $phrase.classList.remove("special");

  // Volta estado normal
  $timer.style.display = "block";
  $advance.classList.remove("show");
  startRotation();
}


  function tick(){
    const t = nowFromServerMs();
    if (t == null) return;

    const nowIn = inWindow(t);

    // Se mudou de estado (entrou ou saiu da janela), aplica o modo correto
    if (wasInWindow === null || nowIn !== wasInWindow) {
      wasInWindow = nowIn;
      if (nowIn) enterWindowMode();
      else exitWindowMode();
    }

    // Atualiza relógio somente fora da janela
    if (!nowIn) {
      const next = nextWindowStartMs(t);
      $timer.textContent = formatHMS(next - t);
    }
  }

  (async function init(){
    await syncTime();
    // força estado inicial correto
    wasInWindow = null;
    tick();
    setInterval(tick, 250);
  })();
  </script>

  <script>
/* =========================
   Proteções básicas (anti-curioso)
   - clique direito
   - atalhos comuns (view-source/devtools/save)
   - zoom: ctrl+wheel, pinça iOS, duplo toque
   ========================= */

(function hardenPage(){
  // 1) Bloqueia menu do botão direito
  document.addEventListener("contextmenu", (e) => e.preventDefault(), { capture:true });

  // 2) Bloqueia seleção/arrasto (reforço via JS)
  document.addEventListener("selectstart", (e) => e.preventDefault(), { capture:true });
  document.addEventListener("dragstart", (e) => e.preventDefault(), { capture:true });

  // 3) Bloqueia atalhos comuns de “ver código” / devtools
  document.addEventListener("keydown", (e) => {
    const key = (e.key || "").toLowerCase();

    const ctrlOrCmd = e.ctrlKey || e.metaKey;

    // F12
    if (e.key === "F12") { e.preventDefault(); e.stopPropagation(); return; }

    // Ctrl/Cmd + U (view source)
    if (ctrlOrCmd && key === "u") { e.preventDefault(); e.stopPropagation(); return; }

    // Ctrl/Cmd + S (save)
    if (ctrlOrCmd && key === "s") { e.preventDefault(); e.stopPropagation(); return; }

    // Ctrl/Cmd + P (print)
    if (ctrlOrCmd && key === "p") { e.preventDefault(); e.stopPropagation(); return; }

    // DevTools: Ctrl/Cmd+Shift+I / J / C
    if (ctrlOrCmd && e.shiftKey && (key === "i" || key === "j" || key === "c")) {
      e.preventDefault(); e.stopPropagation(); return;
    }

    // Ctrl/Cmd + ( + / - / 0 ) zoom
    if (ctrlOrCmd && (key === "+" || key === "-" || key === "=" || key === "0")) {
      e.preventDefault(); e.stopPropagation(); return;
    }
  }, { capture:true });

  // 4) Bloqueia zoom via Ctrl + scroll (desktop)
  window.addEventListener("wheel", (e) => {
    if (e.ctrlKey) e.preventDefault();
  }, { passive:false });

  // 5) iOS Safari: bloqueia gestos (pinça)
  // (gesture* existe no iOS Safari)
  ["gesturestart","gesturechange","gestureend"].forEach(evt => {
    window.addEventListener(evt, (e) => e.preventDefault(), { passive:false });
  });

  // 6) Bloqueia “double tap to zoom” (mobile)
  let lastTouchEnd = 0;
  document.addEventListener("touchend", (e) => {
    const now = Date.now();
    if (now - lastTouchEnd <= 300) {
      e.preventDefault();
    }
    lastTouchEnd = now;
  }, { passive:false });

  // 7) Bloqueia pinça via multi-touch (extra)
  document.addEventListener("touchmove", (e) => {
    if (e.touches && e.touches.length > 1) e.preventDefault();
  }, { passive:false });
})();
</script>

<script>
(function(){
  const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbz4AR_VRHNWUO_LNYdzQ5yfghYEooEiMJFWm2yICuq_0u3PiRGmb-jdcD4z5ly82cex/exec";
  const STEP_NAME = "etapa1"; // troque em cada página: etapa1..etapa7
  const NEXT_URL = "/society/etapa2-c1dgfjkdsaf09123f1x19u21d8945645rth223cc55map12vaa/"; 

  const UTM_KEYS = ["utm_source","utm_medium","utm_campaign","utm_content","utm_term","utm_id","utm_source_platform","utm_creative_format","utm_marketing_tactic"];

  function getQuery(){
    return new URLSearchParams(location.search);
  }

  function getOrCreateUserId(){
    const k = "iron_uid";
    let uid = localStorage.getItem(k);
    if (!uid) {
      uid = (crypto && crypto.randomUUID) ? crypto.randomUUID() : ("uid_" + Math.random().toString(16).slice(2) + Date.now());
      localStorage.setItem(k, uid);
    }
    return uid;
  }

  function persistUtmFirstTouch(){
    const q = getQuery();
    const storeKey = "iron_utm";
    const saved = JSON.parse(localStorage.getItem(storeKey) || "{}");

    // first-touch: só preenche se ainda não existe
    UTM_KEYS.forEach(k => {
      const v = q.get(k);
      if (v && !saved[k]) saved[k] = v;
    });

    localStorage.setItem(storeKey, JSON.stringify(saved));
    return saved;
  }

  function loadUtm(){
    return JSON.parse(localStorage.getItem("iron_utm") || "{}");
  }

  function buildUrlWithParams(url){
    if (!url) return null;
    const base = new URL(url, location.origin);
    const q = new URLSearchParams(base.search);

    const uid = getOrCreateUserId();
    q.set("uid", uid);

    const utm = loadUtm();
    Object.keys(utm).forEach(k => q.set(k, utm[k]));

    base.search = q.toString();
    return base.pathname + (base.search ? "?" + base.search : "");
  }

  function applyParamsToAdvanceLink(){
    if (!NEXT_URL) return;
    const a = document.getElementById("advance");
    if (!a) return;
    a.href = buildUrlWithParams(NEXT_URL);
  }

  async function sendEvent(payload){
    const uid = getOrCreateUserId();
    const utm = loadUtm();

    const body = {
      user_id: uid,
      step: STEP_NAME,
      utm,
      payload: payload || {},
      client_ts: new Date().toISOString(),
      path: location.pathname
    };

    // keepalive ajuda a enviar mesmo se o usuário sair rápido
return fetch(WEBAPP_URL, {
  method: "POST",
  headers: { "Content-Type": "text/plain;charset=utf-8" },
  body: JSON.stringify(body),
  keepalive: true
}).catch(()=>{});  }

  // 1) salva UTMs no primeiro toque
  persistUtmFirstTouch();

  // 2) garante botão avançar com UTMs + uid
  applyParamsToAdvanceLink();

  // 3) registra entrada na página
  sendEvent({ type: "page_enter" });

  // expõe helper pra etapas com respostas
  window.__IRON_TRACK__ = { sendEvent, buildUrlWithParams };
})();
</script>

</body>
</html>
