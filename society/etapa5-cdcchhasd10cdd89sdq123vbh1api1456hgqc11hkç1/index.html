<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>Iron Society</title>

  <style>
    :root { color-scheme: dark; }

    html, body{
      height:100%;
      margin:0;
      background:#000;
      font-family:"Times New Roman", Times, serif;
      overflow:hidden;
      -webkit-text-size-adjust:100%;
      -webkit-user-select: none; user-select: none;
      -webkit-touch-callout: none;
      touch-action: none;
    }

    .wrap{
      height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:24px;
      box-sizing:border-box;
    }

    .stack{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:16px;
      width:100%;
      max-width:900px;
    }

    .fade{
      opacity:0;
      transition: opacity 1400ms ease;
      user-select:none;
      text-wrap: balance;
    }
    .fade.show{ opacity:1; }

    .verse{
      font-size: clamp(18px, 3.6vw, 38px);
      line-height: 1.25;
      font-style: italic;
      color: rgba(255,255,255,0.92);
    }

    .ref{
      font-size: 16px;
      letter-spacing: 0.08em;
      text-transform: none;
      color: rgba(255,255,255,0.62);
      margin-top: -4px;
    }

    .instruction{
      font-size: clamp(18px, 3.2vw, 34px);
      line-height: 1.25;
      font-style: italic;
      color: rgba(255,255,255,0.92);
    }

    .qrWrap{
      display:flex;
      align-items:center;
      justify-content:center;
      margin-top: 4px;
    }

    .qr{
      width: 92px;
      height: 92px;
      opacity: 0.82;
      border-radius: 2px;
      image-rendering: pixelated;
      box-shadow: 0 10px 22px rgba(0,0,0,0.55);
    }

    @media (max-width: 360px){
      .qr{ width: 78px; height: 78px; }
    }

    /* ====== BOTÃO PADRÃO (aço/ferro) ====== */
    .advance{
      opacity:0;
      pointer-events:none;
      padding: 8px 14px;
      border-radius: 2px;
      border: 1px solid rgba(255,255,255,0.22);
      background: linear-gradient(145deg, rgba(190,190,190,0.22), rgba(90,90,90,0.22));
      color: rgba(255,255,255,0.9);
      font-family:"Times New Roman", Times, serif;
      font-size: 14px;
      letter-spacing: 0.10em;
      text-transform: uppercase;
      text-decoration:none;
      user-select:none;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.15),
        inset 0 -1px 0 rgba(0,0,0,0.35),
        0 6px 14px rgba(0,0,0,0.6);
      transition: opacity 1100ms ease;
    }
    .advance.show{
      opacity:1;
      pointer-events:auto;
    }
    .advance:active{ transform: translateY(1px); }

    /* Para usar o mesmo visual em <button> */
    button.advance{
      cursor:pointer;
      appearance:none;
      -webkit-appearance:none;
    }

    /* ====== CAMPO NUMÉRICO (218) ====== */
    .code{
      width: 109px;
      height: 44px;
      box-sizing:border-box;
      background: transparent;
      border: 1px solid rgba(255,255,255,0.22);
      border-radius: 2px;
      outline: none;
      color: rgba(255,255,255,0.92);
      font-family:"Times New Roman", Times, serif;
      font-size: 18px;
      letter-spacing: 0.22em;
      text-align:center;
      padding: 0 12px;
      caret-color: rgba(255,255,255,0.65);
    }
    .code:focus{ border-color: rgba(255,255,255,0.34); }
  </style>
</head>

<body>
  <main class="wrap" aria-label="Iron Society">
    <section class="stack">

      <!-- PERGUNTA INICIAL -->
      <div id="question" class="fade instruction show">
        Você tem esposa ou companheira?
      </div>

      <div id="answers" class="fade show" style="display:flex; gap:18px;">
        <button id="yesBtn" class="advance show" type="button">Sim</button>
        <button id="noBtn"  class="advance show" type="button">Não</button>
      </div>

      <!-- FLUXO "NÃO" (SOLTEIRO) -->
      <div id="soloStep" style="display:none; flex-direction:column; gap:16px; align-items:center; width:100%;">
        <div id="soloMsg1" class="fade instruction">
          “Nem toda aliança começa acompanhada.<br>
          Mas toda aliança começa com responsabilidade.”
        </div>

        <div id="soloMsg2" class="fade verse">
          “Não é bom que o homem esteja só; far-lhe-ei uma ajudadora que lhe seja idônea.”
        </div>

        <div id="soloRef" class="fade ref" style="color:rgba(255,255,255,0.45)">R2VuZXNpcw==</div>

        <input
          id="soloCode"
          class="code fade"
          type="text"
          inputmode="numeric"
          autocomplete="off"
          placeholder=""
          aria-label="Código"
        />

        <a id="soloAdvance" class="advance" href="/society/link-post-insta-solteiro" rel="noopener">
          Avançar
        </a>
      </div>

      <!-- FLUXO "SIM" (CASADO) - SEU FLUXO ATUAL -->
      <div id="marriedFlow" style="display:none; width:100%;">
        <div id="verse" class="fade verse">
          "Portanto, deixará o homem seu pai e sua mãe, e apegar-se-á à sua mulher, e serão ambos uma só carne."
        </div>

        <div id="ref" class="fade ref" style="margin-top:12px;">Gênesis 2:24</div>

<div id="instruction" class="fade instruction">
  “Nenhuma decisão relevante é tomada sozinho."
</div>

<div id="instruction" class="fade instruction" style="margin-top:12px;">
  Este passo exige a presença da sua mulher.
</div>       

        <div id="qrWrap" class="fade qrWrap" aria-hidden="true">
          <img class="qr" src="https://i.imgur.com/33Defql.png" alt="">
        </div>
      </div>

    </section>
  </main>

  <script>
    // ===== Elementos Pergunta =====
    const $question = document.getElementById("question");
    const $answers  = document.getElementById("answers");
    const $yesBtn   = document.getElementById("yesBtn");
    const $noBtn    = document.getElementById("noBtn");

    // ===== Fluxo SIM (casado) =====
    const $marriedFlow  = document.getElementById("marriedFlow");
    const $verse        = document.getElementById("verse");
    const $ref          = document.getElementById("ref");
    const $instruction  = document.getElementById("instruction");
    const $qrWrap       = document.getElementById("qrWrap");

    // ===== Fluxo NÃO (solteiro) =====
    const $soloStep    = document.getElementById("soloStep");
    const $soloMsg1    = document.getElementById("soloMsg1");
    const $soloMsg2    = document.getElementById("soloMsg2");
    const $soloRef     = document.getElementById("soloRef");
    const $soloCode    = document.getElementById("soloCode");
    const $soloAdvance = document.getElementById("soloAdvance");

    const show = (el) => el.classList.add("show");
    const hide = (el) => el.classList.remove("show");

    // Config do seu fluxo atual
    const REF_DELAY_MS   = 1000;
    const VERSE_HOLD_MS  = 10000;
    const NEXT_FADE_GAP  = 1000;

    function resetMarriedFlow(){
      [$verse,$ref,$instruction,$qrWrap].forEach(hide);
    }

    function resetSoloFlow(){
      [$soloMsg1,$soloMsg2,$soloRef,$soloCode].forEach(hide);
      $soloAdvance.classList.remove("show");
      $soloCode.value = "";
    }

    // ===== Clique SIM =====
    $yesBtn.addEventListener("click", () => {
      hide($question);
      hide($answers);

      $soloStep.style.display = "none";
      resetSoloFlow();

      $marriedFlow.style.display = "block";
      resetMarriedFlow();

      // Inicia seu fluxo (só agora)
      setTimeout(() => show($verse), 150);

      setTimeout(() => {
        show($ref);
      }, REF_DELAY_MS);

      setTimeout(() => {
        hide($verse);
        hide($ref);

        setTimeout(() => {
          show($instruction);

          setTimeout(() => {
            show($qrWrap);
          }, 900);

        }, NEXT_FADE_GAP);

      }, VERSE_HOLD_MS);
    });

    // ===== Clique NÃO =====
    $noBtn.addEventListener("click", () => {
      hide($question);
      hide($answers);

      $marriedFlow.style.display = "none";
      resetMarriedFlow();

      $soloStep.style.display = "flex";
      resetSoloFlow();

      // Cena 1: 7s
      setTimeout(() => show($soloMsg1), 150);

      setTimeout(() => {
        hide($soloMsg1);

        // Cena 2: verso + código + campo
        setTimeout(() => {
          show($soloMsg2);
          show($soloRef);
          show($soloCode);
          // não dar focus automático (como você pediu)
        }, 500);

      }, 7000);
    });

    // ===== Validação 218 (somente números) =====
    function digitsOnly(v){ return (v || "").replace(/\D+/g, ""); }

    $soloCode.addEventListener("input", () => {
      const clean = digitsOnly($soloCode.value);
      if ($soloCode.value !== clean) $soloCode.value = clean;

      if (clean === "218") $soloAdvance.classList.add("show");
      else $soloAdvance.classList.remove("show");
    });

  </script>

  <!-- ===== Seu script de proteções (igual) ===== -->
  <script>
  (function hardenPage(){
    document.addEventListener("contextmenu", (e) => e.preventDefault(), { capture:true });
    document.addEventListener("selectstart", (e) => e.preventDefault(), { capture:true });
    document.addEventListener("dragstart", (e) => e.preventDefault(), { capture:true });

    document.addEventListener("keydown", (e) => {
      const key = (e.key || "").toLowerCase();
      const ctrlOrCmd = e.ctrlKey || e.metaKey;

      if (e.key === "F12") { e.preventDefault(); e.stopPropagation(); return; }
      if (ctrlOrCmd && key === "u") { e.preventDefault(); e.stopPropagation(); return; }
      if (ctrlOrCmd && key === "s") { e.preventDefault(); e.stopPropagation(); return; }
      if (ctrlOrCmd && key === "p") { e.preventDefault(); e.stopPropagation(); return; }

      if (ctrlOrCmd && e.shiftKey && (key === "i" || key === "j" || key === "c")) {
        e.preventDefault(); e.stopPropagation(); return;
      }

      if (ctrlOrCmd && (key === "+" || key === "-" || key === "=" || key === "0")) {
        e.preventDefault(); e.stopPropagation(); return;
      }
    }, { capture:true });

    window.addEventListener("wheel", (e) => {
      if (e.ctrlKey) e.preventDefault();
    }, { passive:false });

    ["gesturestart","gesturechange","gestureend"].forEach(evt => {
      window.addEventListener(evt, (e) => e.preventDefault(), { passive:false });
    });

    let lastTouchEnd = 0;
    document.addEventListener("touchend", (e) => {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) e.preventDefault();
      lastTouchEnd = now;
    }, { passive:false });

    document.addEventListener("touchmove", (e) => {
      if (e.touches && e.touches.length > 1) e.preventDefault();
    }, { passive:false });
  })();
  </script>

  <!-- ===== Seu tracking (igual) ===== -->
  <script>
  (function(){
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbz4AR_VRHNWUO_LNYdzQ5yfghYEooEiMJFWm2yICuq_0u3PiRGmb-jdcD4z5ly82cex/exec";
    const STEP_NAME = "etapa5";
    const NEXT_URL = null;

    const UTM_KEYS = ["utm_source","utm_medium","utm_campaign","utm_content","utm_term","utm_id","utm_source_platform","utm_creative_format","utm_marketing_tactic"];

    function getQuery(){ return new URLSearchParams(location.search); }

    function getOrCreateUserId(){
      const k = "iron_uid";
      let uid = localStorage.getItem(k);
      if (!uid) {
        uid = (crypto && crypto.randomUUID) ? crypto.randomUUID() : ("uid_" + Math.random().toString(16).slice(2) + Date.now());
        localStorage.setItem(k, uid);
      }
      return uid;
    }

    function persistUtmFirstTouch(){
      const q = getQuery();
      const storeKey = "iron_utm";
      const saved = JSON.parse(localStorage.getItem(storeKey) || "{}");

      UTM_KEYS.forEach(k => {
        const v = q.get(k);
        if (v && !saved[k]) saved[k] = v;
      });

      localStorage.setItem(storeKey, JSON.stringify(saved));
      return saved;
    }

    function loadUtm(){ return JSON.parse(localStorage.getItem("iron_utm") || "{}"); }

    function buildUrlWithParams(url){
      if (!url) return null;
      const base = new URL(url, location.origin);
      const q = new URLSearchParams(base.search);

      const uid = getOrCreateUserId();
      q.set("uid", uid);

      const utm = loadUtm();
      Object.keys(utm).forEach(k => q.set(k, utm[k]));

      base.search = q.toString();
      return base.pathname + (base.search ? "?" + base.search : "");
    }

    async function sendEvent(payload){
      const uid = getOrCreateUserId();
      const utm = loadUtm();

      const body = {
        user_id: uid,
        step: STEP_NAME,
        utm,
        payload: payload || {},
        client_ts: new Date().toISOString(),
        path: location.pathname
      };

      return fetch(WEBAPP_URL, {
        method: "POST",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify(body),
        keepalive: true
      }).catch(()=>{});
    }

    persistUtmFirstTouch();
    sendEvent({ type: "page_enter" });

    window.__IRON_TRACK__ = { sendEvent, buildUrlWithParams };

    setInterval(() => {
      sendEvent({ type: "heartbeat", every: "10s" });
    }, 10_000);
  })();
  </script>

</body>
</html>
